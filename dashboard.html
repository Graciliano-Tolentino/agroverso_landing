<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- =====================================================================================
  üåê dashboard-unificado.html ‚Äì Painel Personalizado Agroverso
  üîê Seguran√ßa regenerativa, UX din√¢mica e controle por perfil com base em JWT
  ====================================================================================== -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <title>Painel ‚Ä¢ Agroverso</title>
  <meta name="description" content="Painel adaptado por perfil de acesso no sistema Agroverso. Veja fun√ß√µes exclusivas conforme seu tipo de usu√°rio." />
  <meta name="author" content="Instituto Graciliana Maria da Concei√ß√£o" />
  <meta name="robots" content="noindex, nofollow" />

  <link rel="stylesheet" href="assets/css/dashboard.css" />
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon" />
</head>

<body class="dashboard-body">
  <main class="dashboard-container" role="main" aria-label="Painel do Usu√°rio Agroverso">
    <section class="dashboard-box" aria-labelledby="painel-titulo">
      <h1 id="painel-titulo" class="dashboard-title">üéØ Painel Personalizado Agroverso</h1>

      <p class="dashboard-subtitle" id="subtitulo-perfil">
        Este painel foi ajustado dinamicamente conforme seu tipo de usu√°rio.
      </p>

      <div id="mensagem-perfil" class="dashboard-message" role="region" aria-live="polite">
        <!-- Conte√∫do ser√° injetado aqui -->
      </div>

      <div class="dashboard-footer">
        <button onclick="logout()" class="btn-secondary" aria-label="Encerrar sess√£o e retornar ao login">üö™ Sair</button>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const mensagemEl = document.getElementById("mensagem-perfil");
      const subtitulo = document.getElementById("subtitulo-perfil");

      // üß© Tenta recuperar e decodificar o token JWT simulado
      const token = localStorage.getItem("agro_token");
      if (!token) {
        alert("‚ö†Ô∏è Sess√£o n√£o encontrada. Fa√ßa login novamente.");
        return window.location.href = "login.html";
      }

      let payload;
      try {
        payload = JSON.parse(atob(token));
      } catch (erro) {
        console.error("‚ùå Token corrompido:", erro);
        localStorage.removeItem("agro_token");
        return window.location.href = "login.html";
      }

      const { email, perfil, exp } = payload;

      if (!email || !perfil || !exp || Date.now() > exp) {
        alert("‚ö†Ô∏è Sess√£o expirada ou inv√°lida. Fa√ßa login novamente.");
        localStorage.removeItem("agro_token");
        return window.location.href = "login.html";
      }

      // üé® Conte√∫dos din√¢micos por tipo de perfil
      const conteudos = {
        administrador: {
          titulo: "üëë Administrador Geral",
          texto: `
            Voc√™ possui acesso irrestrito ao sistema.
            <ul>
              <li>Gerenciar usu√°rios e permiss√µes</li>
              <li>Visualizar relat√≥rios e gr√°ficos anal√≠ticos</li>
              <li>Acompanhar projetos e configura√ß√µes globais</li>
            </ul>`
        },
        gerente: {
          titulo: "üìä Gerente",
          texto: `
            Seu painel permite vis√£o operacional e estrat√©gica.
            <ul>
              <li>Coordena√ß√£o de equipes e valida√ß√£o de entregas</li>
              <li>Controle de produ√ß√£o e relat√≥rios gerenciais</li>
            </ul>`
        },
        lider: {
          titulo: "üß≠ L√≠der de Equipe",
          texto: `
            Voc√™ lidera execu√ß√µes e valida√ß√µes de campo.
            <ul>
              <li>Atribui√ß√£o de ordens de servi√ßo</li>
              <li>Envio de relat√≥rios georreferenciados</li>
            </ul>`
        },
        tecnico: {
          titulo: "üîß T√©cnico de Campo",
          texto: `
            Foco em execu√ß√£o pr√°tica e mobilidade.
            <ul>
              <li>Envio de fotos e medi√ß√µes</li>
              <li>Atualiza√ß√£o de sensores e feedback de campo</li>
            </ul>`
        }
      };

      if (conteudos[perfil]) {
        const c = conteudos[perfil];
        mensagemEl.innerHTML = `<h2>${c.titulo}</h2><div class="perfil-texto">${c.texto}</div>`;
      } else {
        mensagemEl.innerHTML = `
          <h2>‚ö†Ô∏è Perfil n√£o reconhecido</h2>
          <p>N√£o foi poss√≠vel identificar seu perfil. <a href="login.html">Voltar ao login</a>.</p>`;
        subtitulo.textContent = "Erro na identifica√ß√£o da sess√£o.";
      }

      // ‚úÖ Registro global dispon√≠vel
      window.usuarioAgroverso = { email, perfil };
    });
  </script>

  <!-- üîÅ Scripts institucionais -->
  <script src="scripts/auth.js" defer></script>
  <script src="scripts/logout.js" defer></script>
</body>
</html>

